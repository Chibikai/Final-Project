window.tgxToKarma=window.tgxToKarma||{vars:{debug:false,environment:null,initialized:false,ready:false,reloaded:false,scriptPath:"",hostname:window.location.hostname.split(".").splice(-2)[0],isTranslatedFromTgx:true,deactivatedHostnames:["departures"]},queue:[]};window.karma=window.karma||{};window.karma.cmd=window.karma.cmd||[];window.karma.config=window.karma.config||{targeting:{},docking:{}};window.karma.vars=window.karma.vars||{};window.karma.vars.isTranslatedFromTgx=true;window.googletag=window.googletag||{};window.googletag.cmd=window.googletag.cmd||[];function foo(){}function log(msg,force){if(force||window.tgxToKarma.vars.debug||window.location.search.indexOf("tgxToKarmaDebug=true")!==-1){console.log("%c "+"TGX->KARMA: "+msg,"background: #222; color: #bada55")}}function extend(obj1,obj2){if(obj2){Object.keys(obj2).forEach((function(p){try{if(obj2[p].constructor===Object){obj1[p]=extend(obj1[p],obj2[p])}else{obj1[p]=obj2[p]}}catch(e){obj1[p]=obj2[p]}}))}return obj1}window.tgxToKarma.config=function(doc,win){const c=win.karma.config,userAgent=win.navigator.userAgent,pathName=win.location.pathname,pageMap={"2015 Destination Guide":"category",app:"app",author:"profile",blog:"post",blogs:"post",business_listing_landing_page:"landing_page",buying_guides:"buyingguides",buyingguides:"reviews",calendar:"slideshow",campaign:"page",condition_center:"app",content:"page",contentcollection:"collection",custom:"page",franchise:"page",gallery:"slideshow",generic:"page",genericpage:"page",hgallery:"slideshow",image:"photos",list:"checklist",listicle:"article",magazine:"page",main:"category",menu:"recipe_hub",multitag:"tag",package:"category",playlist:"landing_page",poy:"article",recap:"article",section:"category",sectionfront:"category",sl50:"landing_page",storied:"app",subchannel:"category",syndicatedslideshow:"slideshow",toc:"landing_page",topic:"category",topicpage:"category",topicpagechild:"category",tout:"page",tvrecapsubchannel:"category",vertical_gallery:"slideshow",verticalgallery:"slideshow",videoarchive:"video_hub",videoarticle:"video_article",videolandingpage:"video_hub",videos:"video_hub",videoseries:"video_hub"};c.apiVersion=3;c.isMobile=!!userAgent.match(/Mobi/)&&!userAgent.match(/iPad/);c.targeting.plat=c.isMobile?"mobile":"desktop";c.go=function(){window.karma.cmd.push("go")};function existsAndNotEmpty(str){return str&&str!==""}function getCookie(sKey){if(!sKey){return null}const cookie=doc.cookie;return decodeURIComponent(cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(sKey).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null}function convertConfig(manualConfig){const keyMap={content_id:"aid",site_section1:"ch",content_package_id:"pid",site_section2:"sch",pi_page_type:"ptype",template_type:"ctype"},tgxScriptNode=doc.getElementById("tgx-script"),tgxTargeting={};let tempObj={};if(manualConfig){if(manualConfig.setGlobalTargeting){Object.keys(manualConfig.setGlobalTargeting).forEach((function(key){tempObj[key]=manualConfig.setGlobalTargeting[key]}))}if(manualConfig.setTargeting){Object.keys(manualConfig.setTargeting).forEach((function(key){tempObj[key]=manualConfig.setTargeting[key]}))}}else{if(tgxScriptNode&&tgxScriptNode.dataset.tgxtargeting){tempObj=JSON.parse(decodeURIComponent(tgxScriptNode.dataset.tgxtargeting))}if(win.Ti&&win.Ti.udo_metadata){log("win.Ti.udo_metadata:"+JSON.stringify(win.Ti.udo_metadata));tempObj=extend(tempObj,win.Ti.udo_metadata)}if(win.ti_dfp_config&&win.ti_dfp_config.setGlobalTargeting){log("win.ti_dfp_config:"+JSON.stringify(win.ti_dfp_config));c.tgxSiteName=win.ti_dfp_config.setTargeting.site;tempObj=extend(tempObj,win.ti_dfp_config.setGlobalTargeting)}if(win.Drupal&&win.Drupal.settings.ad_settings&&win.Drupal.settings.ad_settings.adFactory){log("win.Drupal.settings.ad_settings.adFactory:"+JSON.stringify(win.Drupal.settings.ad_settings.adFactory));Object.keys(win.Drupal.settings.ad_settings.adFactory).forEach((function(key){if(typeof win.tgxToKarma.config[key]==="function"){win.tgxToKarma.config[key](win.Drupal.settings.ad_settings.adFactory[key])}}))}}log("tempObj:"+JSON.stringify(tempObj));if(tempObj){Object.keys(tempObj).forEach((function(k){tgxTargeting[keyMap[k]||k]=tempObj[k];c.targeting[keyMap[k]||k]=tempObj[k]}))}setId(tgxTargeting);c.targeting.path=pathName.split("/").filter((function(v){return v!==""}));if(existsAndNotEmpty(tgxTargeting.ch)){c.targeting.channel=tgxTargeting.ch}if(existsAndNotEmpty(tgxTargeting.sch)){c.targeting.parent=tgxTargeting.sch}c.targeting.domain=win.location.hostname;const tiId=getCookie("globalTI_SID");if(tiId){c.targeting.ti_id=tiId}setType(tgxTargeting);const aamId=getCookie("aam_uuid");if(aamId){c.targeting.aamid=aamId}log("win.karma.config:"+JSON.stringify(win.karma.config))}function setId(targeting){if(existsAndNotEmpty(targeting.id)){c.targeting.id=targeting.id}else if(existsAndNotEmpty(targeting.aid)){c.targeting.id=targeting.aid}else if(existsAndNotEmpty(targeting.cid)){c.targeting.id=targeting.cid}else if(existsAndNotEmpty(targeting.pid)){c.targeting.id=targeting.pid}else if(existsAndNotEmpty(targeting.articleID)){c.targeting.id=targeting.articleID}if(!c.targeting.id||c.targeting.id===""){c.targeting.id=pathName.substr(1,pathName.length<40?pathName.length:40).replace(/\//g,"_").replace(/[^a-z0-9-]/gi,"")}return c.targeting.id}function mapType(type){return pageMap.hasOwnProperty(type)?pageMap[type]:type}function setType(targeting){if(existsAndNotEmpty(targeting.ctype)){c.targeting.type=mapType(targeting.ctype)}else if(existsAndNotEmpty(targeting.ptype)){c.targeting.type=mapType(targeting.ptype)}return c.targeting.type}function setParam(key,value){if(typeof key==="object"){Object.keys(key).forEach((function(k){if(!k.match(/id|targeting|size|sizes/)){setParam(k,key[k])}}));return false}if(value===undefined){return false}if(c.targeting.hasOwnProperty(key)&&c.targeting[key]!==value){if(typeof c.targeting[key]!=="object"){c.targeting[key]=[c.targeting[key]]}if(Array.isArray(c.targeting[key])){c.targeting[key].push(value)}}c.targeting[key]=typeof value==="string"&&value.indexOf(",")!==-1?value.split(","):value;if(key.match(/id$/)){setId(c.targeting)}else if(key.match(/type$/)){setType(c.targeting)}if(win.karma.vars.initialized){if(typeof win.karma.updateTargeting==="function"){window.karma.updateTargeting(c.targeting)}else{win.karma.cmd.push((function(){window.karma.updateTargeting(c.targeting)}))}}return value}function setArticleId(v){setParam("aid",v);setId(c.targeting)}function setPackageId(v){setParam("pid",v);setId(c.targeting)}function setChannel(v){setParam("ch",v);setParam("channel",v)}function setSubchannel(v){setParam("sch",v);setParam("parent",v)}function setContentType(v){setParam("ctype",v);setType(c.targeting)}function setZone(k,v){setParam("zone",v)}function setSitename(v){let site=v.split(".").pop();const map={mre2:"mre",hlt2:"hlt",fort_mob:"fort"};if(map[site]){site=map[site]}c.site=site+".mdp."+(c.isMobile?"mob":"com")}return{init:convertConfig,setParam:setParam,setSitename:setSitename,setCmSitename:foo,filterSitename:foo,setBehaviorTracking:foo,setTacodaTracking:foo,setQuantcastTracking:foo,setdisableInitLoad:foo,setsingleRequestMode:foo,setDequeueAds:foo,setConvertHyphens:foo,setStripNonAlphaNumeric:foo,setLazyLoad:foo,setLazyRange:foo,setPopups:foo,setRevSciTracking:foo,setChannelPage:foo,setArticleId:setArticleId,setPackageId:setPackageId,setChannel:setChannel,setSubchannel:setSubchannel,setContentPage:foo,setContentType:setContentType,setZone:setZone}}(document,window);window.tgxToKarma.slots=function(doc,win){const karmaSlots={},karmaTiersByType={},c=win.karma.config,slotSizeMap={"728x90":"leaderboard","970x90":"leaderboard","970x250":"leaderboard","900x500":"leaderboard","300x250":"square","300x600":"square","1050x600":"square","300x50":"banner","320x50":"banner","1x6":"related"},hostname=win.location.hostname.split(".").slice(-2)[0],siteConfigs={departures:{injectMobileAdhesive:false,stickyClasses:[]}},shouldInjectMobileAdhesive=siteConfigs[hostname]&&siteConfigs[hostname].injectMobileAdhesive||true,stickyIds=siteConfigs[hostname]&&siteConfigs[hostname].stickyIds?siteConfigs[hostname].stickyIds:["ad-footer-sticky","tethered-ad","univ-adhesion-ad","ad-mobile-adhesion","ad_resp_leaderboard","mobile-adhesive-ad","ad-adhesion-320x50_300x50"],stickyClasses=siteConfigs[hostname]&&siteConfigs[hostname].stickyClasses?siteConfigs[hostname].stickyClasses:["sticky-ad","anchor-ad"];function karmaIndexByType(slotType){return karmaSlots[slotType].length}function incrementTier(slotType){karmaTiersByType[slotType]++;if(karmaTiersByType[slotType]>4){karmaTiersByType[slotType]=1}return karmaTiersByType[slotType]}function getSlotSettings(tgxPlaceholder){let slotConfig;if(win.Drupal&&win.Drupal.settings){slotConfig=win.Drupal.settings[tgxPlaceholder.id];slotConfig.sizes=Object.keys(slotConfig.sizes[c.isMobile?0:1e3])}return slotConfig}function writeAd(id){log("this.size: "+this.size);const slot={size:this.size};let placeholder;if(id){slot.id=id}else{const scripts=document.getElementsByTagName("script");placeholder=scripts[scripts.length-1].parentNode}insertKarmaPlaceholder(slot,placeholder)}function getAd(width,height){return{size:[width,height],write:writeAd,setParam:foo,setPosition:foo}}function getMultiAd(sizeArray){return{size:sizeArray,write:writeAd,setParam:foo,setPosition:foo}}function isNumeric(val){return/^\d+$/.test(val)}function createSlot(slotConfig,tgxPlaceholder){const slot={tgxId:slotConfig&&slotConfig.id||tgxPlaceholder.id,type:null},validSizes=Object.keys(slotSizeMap);slot.tgxPlaceholder=tgxPlaceholder?tgxPlaceholder:slot.tgxId?document.getElementById(slot.tgxId):null;slot.tgxClasses=slot.tgxPlaceholder&&slot.tgxPlaceholder.className||null;slot.tgxPosition=slot.tgxPlaceholder&&(slot.tgxPlaceholder.style.position||getComputedStyle(slot.tgxPlaceholder).position)||null;if(!slotConfig){slotConfig=getSlotSettings(tgxPlaceholder)}else{slotConfig.sizes=slotConfig.size;if(typeof slotConfig.size[0]==="object"&&Array.isArray(slotConfig.size[0])&&isNumeric(slotConfig.size[0][0])){slotConfig.sizes=slotConfig.size.map((function(v){return v.join("x")}))}else if(isNumeric(slotConfig.size[0])){slotConfig.sizes=[slotConfig.size.join("x")]}}slotConfig.sizes=slotConfig.sizes.filter((function(size){return validSizes.indexOf(size)!==-1}));log("slotConfig: "+JSON.stringify(slotConfig));slot.sizes=slotConfig.sizes;if(slotConfig.type){slot.type=slotConfig.type}else{for(let i=0,l=slot.sizes.length;i<l;i++){if(slotSizeMap.hasOwnProperty(slot.sizes[i])){slot.type=slotSizeMap[slot.sizes[i]];break}}}if(c.isMobile){const hasStickyId=stickyIds.length>0&&slot.tgxId&&slot.tgxId.match(new RegExp(stickyIds.join("|"))),hasStickyClass=stickyClasses.length>0&&slot.tgxClasses&&slot.tgxClasses.match(new RegExp(stickyClasses.join("|")));let hasFixedPosition=slot.tgxPosition&&slot.tgxPosition==="fixed";if(!hasFixedPosition&&slot.tgxPlaceholder){let el=slot.tgxPlaceholder,parentsToCheck=3;while(parentsToCheck--){if(getComputedStyle(el).position==="fixed"){hasFixedPosition=true}el=el.parentElement||el.parentNode}}if((hasStickyId||hasStickyClass||hasFixedPosition)&&!karmaSlots["adhesive-banner"]){slot.type="adhesive-banner"}}if(karmaSlots[slot.type]&&karmaSlots[slot.type].indexOf(slot.tgxId)!==-1){return false}slot.sizeType=slot.type==="adhesive-banner"||slot.sizes.length===1&&slot.sizes[0]!=="900x500"?"-fixed":"-flex";slot.id="div-gpt-"+(c.isMobile?"mob-":"")+slot.type+(slot.type!=="related"?slot.sizeType:"");karmaSlots[slot.type]=karmaSlots[slot.type]||[];karmaTiersByType[slot.type]=karmaTiersByType[slot.type]||0;karmaSlots[slot.type].push(slot.tgxId+"->"+slot.id);slot.id+="-"+karmaIndexByType(slot.type);slot.tier=incrementTier(slot.type);return slot}function createKarmaPlaceholder(slotConfig,tgxPlaceholder){const slot=createSlot(slotConfig,tgxPlaceholder),karmaDiv=!slot||slot.type===null?false:doc.createElement("div");if(karmaDiv){karmaDiv.id=slot.id;karmaDiv.setAttribute("data-tier",slot.tier);karmaDiv.setAttribute("data-tgx-id",slot.tgxId);log("new KARMA slot: "+slot.id+":tier"+slot.tier)}return karmaDiv}function insertKarmaPlaceholder(slotConfig,tgxDiv){const karmaDiv=createKarmaPlaceholder(slotConfig,tgxDiv),relocateSelector=tgxDiv&&tgxDiv.dataset?tgxDiv.dataset.relocateSelector:null;let whereToInsert=tgxDiv||(slotConfig?doc.getElementById(slotConfig.id):doc.getElementById(karmaDiv.dataset.tgxId));if(relocateSelector){whereToInsert=doc.querySelector(relocateSelector)}if(whereToInsert==="null"||karmaDiv===false){return false}const insertType=tgxDiv&&tgxDiv.dataset?tgxDiv.dataset.relocatePosition:"append";if(win.karma.vars.initialized&&win.karma.queueExecuted===undefined||win.karma.vars.queueExecuted){karma.cmd.push((function(){window.karma.createSlot(karmaDiv.id.replace(/div-gpt-(.*)-\d+/,"div-gpt-lazy-$1")+"-tier"+karmaDiv.dataset.tier,whereToInsert,true)}));return false}if(insertType==="append"){return whereToInsert.appendChild(karmaDiv)}return whereToInsert.parentNode.insertBefore(karmaDiv,tgxDiv)}function injectMobileAdhesive(){log("injecting mobile adhesive container...");const adhesiveBannerContainer=doc.createElement("div");adhesiveBannerContainer.id="mobileHoverBannerWrapper";adhesiveBannerContainer.dataset.relocatePosition="append";const styleSheet=doc.createElement("style");styleSheet.id="dockingStyles";styleSheet.innerHTML="#mobileHoverBannerWrapper{ position:fixed; bottom:0; width:320px; left:50%; margin-left:-160px; z-index:450;}";doc.getElementsByTagName("head")[0].appendChild(styleSheet);doc.body.appendChild(adhesiveBannerContainer);return insertKarmaPlaceholder({size:[320,50],type:"adhesive-banner"},adhesiveBannerContainer)}function init(tgxConfig){log("init of TGX to KARMA translator");if(win.tgxToKarma.vars.deactivatedHostnames.indexOf(win.tgxToKarma.vars.hostname)!==-1){log("aborting the call to KARMA because the site "+win.tgxToKarma.vars.hostname+" is disabled");return false}win.tgxToKarma.config.init(tgxConfig);win.tgxToKarma.vars.initialized=true;if(shouldInjectMobileAdhesive){win.karma.cmd.push((function(){if(window.karma.config.isMobile&&Object.keys(karmaSlots).indexOf("adhesive-banner")===-1){injectMobileAdhesive()}}))}const script=document.createElement("script");script.src="https://karma.mdpcdn.com/service/js-min/karma.js";document.getElementsByTagName("head")[0].appendChild(script)}function refreshAds(){log("manual refresh is not currently supported in this version of the TGX->KARMA translator",true)}function slotRenderEnded(fn){window.karma.config.callback=window.karma.config.callback||[];window.karma.config.callback.push(fn)}function writeFoo(){return{write:foo}}const methods={init:init,defineSlot:insertKarmaPlaceholder,catalog:karmaSlots,clearRefreshAds:foo,clearRefreshBatchAds:foo,clearParam:foo,createAd:insertKarmaPlaceholder,tgx_div:insertKarmaPlaceholder,getAd:getAd,getCmAd:writeFoo,getMultiAd:getMultiAd,getMultiCmAd:writeFoo,getTransitionalAd:writeFoo,loadOop:foo,params:c.targeting,refreshAds:refreshAds,refreshBatchAds:refreshAds,resetOOP:foo,setChannelPage:foo,setLazyLoad:foo,slotRenderEnded:slotRenderEnded},configMethods=["setArticleId","setPackageId","setChannel","setSubchannel","setContentPage","setContentType","setZone","setParam"];let l=configMethods.length;while(l--){const method=configMethods[l];methods[method]=win.tgxToKarma.config[method]}return methods}(document,window);window.tgxToKarma.vars.ready=true;if(typeof window.time_dfp==="object"&&Array.isArray(window.time_dfp)){window.tgxToKarma.queue=window.tgxToKarma.queue.concat(window.time_dfp.filter((function(fn){return typeof fn==="function"})))}window.time_dfp=function(){const config={setTargeting:{},setGlobalTargeting:{},enableSingleRequest:true,disableInitialLoad:true,collapseEmptyDivs:true,sitename:"",comscore:false,oop:false,zone:"",gptAsync:false};function refresh(){log("manual refresh is not currently supported in this version of the TGX->KARMA translator",true)}function push(func){if(typeof func==="function"){try{func()}catch(e){log("error running function: "+e,true)}}}return{dfpUtil:foo,config:config,init:window.tgxToKarma.slots.init,defineSlot:window.tgxToKarma.slots.defineSlot,refresh:refresh,updateCorrelator:foo,setTargeting:window.tgxToKarma.config.setParam,push:push}}();while(window.tgxToKarma.queue.length>0){try{window.tgxToKarma.queue[0]()}catch(e){log("error running function: "+e,true)}window.tgxToKarma.queue.splice(0,1)}window.TiiAdConfig=function(sitename){if(sitename){window.tgxToKarma.config.setSitename(sitename)}return window.tgxToKarma.config};window.TiiAdFactory=function(config){window.tgxToKarma.slots.init(config);return window.tgxToKarma.slots};function TgxData(){this.params={};this.bkparams=[];this.pageparams=[];this.slotparams=[];this.refreshSlot=null;this.istSlot=null;this.istCmSlot=null;this.parentDiv=null;this.zone="";this.slotQueue=[];this.renderingMode=null;this.processMode=null;this.disableinitMode=null;this.singlerequestMode=null;this.slots=[];this.slotkeys=[];this.oopslots=[]}window.tgxDo=new TgxData;const functionList=["TimeHatConfig","TiiAdGetQuantcastSegments","TiiAdTrackRevSci","TiiAdQuantBlueKaiMindsetImpl","TiiAdFactorySetbkParam","_TiiAudsciTargeting","TiiAdTrackBehavior","TiiAdGetTacodaSegments","TiiAdGetRevSciSegments","TiiAdsGetVideoTestParam","tiiAdSetType","tiiAdSetTarget","tiiHtmlAdWH","TiiBkBeacon","TiiBkFireBeacon","TgxUtilGetRootDomain","TgxUtilGetSubDomain"];for(let i=0;i<functionList.length;i++){window[functionList[i]]=foo}
//# sourceMappingURL=tgx2karma.js.map
